<?xml version="1.0" encoding="utf-8" ?>
<Patch>
	<Operation Class="PatchOperationFindMod">
		<mods>
			<li>Astra Militarum Imperial Guard Core Mod v2.3</li>
		</mods>
		<match Class="PatchOperationSequence">
		<operations>

		<!-- ========== Kill recipe maker ========== -->

		<li Class="PatchOperationAttributeSet">
			<xpath>/Defs/ThingDef[defName="Grenade_Krak"]</xpath>
			<attribute>ParentName</attribute>
			<value>BaseWeapon</value>
		</li>

		<!-- ========== Melee tools ========== -->

		<li Class="PatchOperationAdd">
			<xpath>/Defs/ThingDef[defName="Grenade_Krak"]</xpath>
			<value>
				<tools>
				<li Class="CombatExtended.ToolCE">
					<label>Body</label>
					<capacities>
					<li>Blunt</li>
					</capacities>
					<power>2</power>
					<cooldownTime>1.75</cooldownTime>
					<armorPenetrationBlunt>1.0</armorPenetrationBlunt>
					<linkedBodyPartsGroup>Base</linkedBodyPartsGroup>
				</li>
				</tools>
			</value>
		</li>

		<!-- ========== Krak Grenade Projectile ========== -->

		<li Class="PatchOperationReplace">
			<xpath>/Defs/ThingDef[@Name="IGBaseGrenadeProjectile"]/thingClass</xpath>
			<value>
				<thingClass>CombatExtended.ProjectileCE_Explosive</thingClass>
			</value>
		</li>

		<li Class="PatchOperationAttributeSet">
			<xpath>/Defs/ThingDef[@Name="IGBaseGrenadeProjectile"]/projectile</xpath>
			<attribute>Class</attribute>
			<value>CombatExtended.ProjectilePropertiesCE</value>
		</li>

		<li Class="PatchOperationAdd">
			<xpath>/Defs/ThingDef[@Name="IGBaseGrenadeProjectile"]/projectile</xpath>
			<value>
				<explosionDamageFalloff>true</explosionDamageFalloff>
			</value>
		</li>

		<!-- ========== Krak Grenade ========== -->

		<!-- Projectile -->

		<li Class="PatchOperationReplace">
			<xpath>/Defs/ThingDef[defName="Proj_KrakGrenade"]/projectile</xpath>
			<value>
				<projectile Class="CombatExtended.ProjectilePropertiesCE">
					<explosionRadius>3</explosionRadius>
					<damageDef>Bomb</damageDef>
					<damageAmountBase>200</damageAmountBase>
					<explosionDelay>60</explosionDelay>
					<dropsCasings>true</dropsCasings>
					<casingMoteDefname>Mote_GrenadePin</casingMoteDefname>
					<applyDamageToExplosionCellsNeighbors>true</applyDamageToExplosionCellsNeighbors>
					<speed>12</speed>
					<gravityFactor>2</gravityFactor>
					<soundExplode>IGMED_Explosion</soundExplode>					
				</projectile>
			</value>
		</li>

		<!-- Grenade -->

		<li Class="PatchOperationReplace">
			<xpath>/Defs/ThingDef[defName="Grenade_Krak"]/graphicData</xpath>
			<value>
				<graphicData>
					<texPath>Things/Ammo/HandGrenades/Frag</texPath>
					<graphicClass>Graphic_StackCount</graphicClass>
					<onGroundRandomRotateAngle>0</onGroundRandomRotateAngle>
				</graphicData>
			</value>
		</li>

		<li Class="PatchOperationAdd">
			<xpath>/Defs/ThingDef[defName="Grenade_Krak"]</xpath>
			<value>
				<thingClass>CombatExtended.AmmoThing</thingClass>
				<stackLimit>75</stackLimit>
				<resourceReadoutPriority>First</resourceReadoutPriority>
			</value>
		</li>

		<li Class="PatchOperationAttributeSet">
			<xpath>/Defs/ThingDef[defName="Grenade_Krak"]</xpath>
			<attribute>Class</attribute>
			<value>CombatExtended.AmmoDef</value>
		</li>

		<li Class="CombatExtended.PatchOperationMakeGunCECompatible">
			<defName>Grenade_Krak</defName>
			<statBases>
				<Mass>0.7</Mass>
				<Bulk>0.9</Bulk>
				<MarketValue>12.22</MarketValue>
				<RangedWeapon_Cooldown>1</RangedWeapon_Cooldown>
				<SightsEfficiency>0.65</SightsEfficiency>
			</statBases>
			<Properties>
				<label>throw krak grenade</label>
				<verbClass>CombatExtended.Verb_ShootCEOneUse</verbClass>
				<hasStandardCommand>true</hasStandardCommand>
				<range>10.0</range>
				<minRange>4</minRange>
				<warmupTime>0.8</warmupTime>
				<noiseRadius>4</noiseRadius>
				<ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
				<soundCast>ThrowGrenade</soundCast>
				<targetParams>
					<canTargetLocations>true</canTargetLocations>
				</targetParams>
				<defaultProjectile>Proj_KrakGrenade</defaultProjectile>
				<onlyManualCast>true</onlyManualCast>
				<ignorePartialLoSBlocker>true</ignorePartialLoSBlocker>
				<ai_AvoidFriendlyFireRadius>7</ai_AvoidFriendlyFireRadius>
			</Properties>
			<weaponTags>
				<li>CE_AI_AOE</li>
				<li>CE_OneHandedWeapon</li>
			</weaponTags>
		</li>

		</operations>
		</match>
	</Operation>
</Patch>